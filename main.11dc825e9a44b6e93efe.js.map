{"version":3,"sources":["webpack:///./index.js","webpack:///./template/commentsPage.hbs","webpack:///./template/mainPage.hbs"],"names":["modalEl","refs","form","document","querySelector","nameInput","commentInput","commentsList","loginBtn","formBtn","sendRequest","e","preventDefault","value","comment","fetch","method","body","JSON","stringify","headers","then","resp","json","data","id","name","addToLocal","renderComments","sendComments","date","Date","now","toLocaleDateString","toLocaleTimeString","error","text","delay","commentsArr","getCommentsFromLocal","push","localStorage","setItem","parse","getItem","commentArr","markup","map","el","join","innerHTML","deleteComment","target","nodeName","filteredComments","filter","parentNode","console","log","openModalLog","createElement","classList","add","mui","overlay","addEventListener","onSubmitLog","email","password","returnSecureToken","idToken","loginUser","getData","token","arrData","Object","values","commentsPage","logOut","Promise","reject","alert","mainPage","debounce","leading","trailing","window","Handlebars","module","exports","template","container","depth0","helpers","partials","helper","alias1","nullContext","alias2","hooks","helperMissing","alias4","escapeExpression","lookupProperty","parent","propertyName","prototype","hasOwnProperty","call","stack1","program","noop"],"mappings":"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","file":"main.11dc825e9a44b6e93efe.js","sourcesContent":["//AIzaSyCniRY8mOu8mbV8PRMWbZHKAGJrPGGPrL8\r\n\r\nimport './styles.css';\r\nimport { error } from '@pnotify/core';\r\nimport '@pnotify/core/dist/PNotify.css';\r\nimport '@pnotify/core/dist/BrightTheme.css';\r\nimport debounce from 'lodash.debounce';\r\nimport commentsPage from './template/commentsPage.hbs';\r\nimport mainPage from './template/mainPage.hbs';\r\n\r\nconst refs = {\r\n  form: document.querySelector('.comment-form'),\r\n  nameInput: document.querySelector('.name'),\r\n  commentInput: document.querySelector('.comment'),\r\n  commentsList: document.querySelector('.comments'),\r\n  loginBtn: document.querySelector('.log-btn '),\r\n  formBtn: document.querySelector('.submit-form'),\r\n};\r\n\r\nfunction sendComments(comment) {\r\n  return fetch(\r\n    'https://firstproject-b95dd-default-rtdb.europe-west1.firebasedatabase.app/comments.json',\r\n    {\r\n      method: 'POST',\r\n      body: JSON.stringify(comment),\r\n      headers: {\r\n        'content-type': 'application/json',\r\n      },\r\n    },\r\n  )\r\n    .then(resp => resp.json())\r\n    .then(data => {\r\n      comment.id = data.name;\r\n      return comment;\r\n    })\r\n    .then(addToLocal)\r\n    .then(renderComments);\r\n}\r\n\r\nfunction sendRequest(e) {\r\n  e.preventDefault();\r\n\r\n  if (document.querySelector('.name').value === '') {\r\n    error({\r\n      text: 'input for name is empty',\r\n      delay: 1000,\r\n    });\r\n    return;\r\n  }\r\n\r\n  if (document.querySelector('.comment').value === '') {\r\n    error({\r\n      text: 'input for comment is empty',\r\n      delay: 1000,\r\n    });\r\n    return;\r\n  }\r\n\r\n  const comment = {\r\n    date: `${new Date(Date.now()).toLocaleDateString()} ${new Date(\r\n      Date.now(),\r\n    ).toLocaleTimeString()}`,\r\n    name: document.querySelector('.name').value,\r\n    comment: document.querySelector('.comment').value,\r\n  };\r\n  sendComments(comment);\r\n}\r\n\r\nrefs.form.addEventListener(\r\n  'submit',\r\n  debounce(sendRequest, 500, { leading: true, trailing: false }),\r\n  false,\r\n);\r\n\r\nfunction addToLocal(comment) {\r\n  const commentsArr = getCommentsFromLocal();\r\n  commentsArr.push(comment);\r\n  localStorage.setItem('comments', JSON.stringify(commentsArr));\r\n}\r\n\r\nfunction getCommentsFromLocal() {\r\n  return JSON.parse(localStorage.getItem('comments') || '[]');\r\n}\r\n\r\nfunction renderComments() {\r\n  const commentArr = getCommentsFromLocal();\r\n  document.querySelector('.name').value = '';\r\n  document.querySelector('.comment').value = '';\r\n  const markup = commentArr\r\n    .map(el => {\r\n      return `<li id=\"${el.id}\">  \r\n      <h3>${el.name}</h3>\r\n      <p>${el.date}</p>\r\n      <p>${el.comment}</p>\r\n      <button class=\"delete\">delete</button>\r\n    </li>`;\r\n    })\r\n    .join('');\r\n  document.querySelector('.comments').innerHTML = markup;\r\n}\r\n\r\nwindow.addEventListener('load', renderComments);\r\n\r\nrefs.commentsList.addEventListener('click', deleteComment);\r\n\r\nfunction deleteComment(e) {\r\n  if (e.target.nodeName !== 'BUTTON') {\r\n    console.log('heko');\r\n    return;\r\n  }\r\n  const filteredComments = getCommentsFromLocal().filter(el => {\r\n    return el.id !== e.target.parentNode.id;\r\n  });\r\n  localStorage.setItem('comments', JSON.stringify(filteredComments));\r\n  renderComments();\r\n}\r\n\r\nrefs.loginBtn.addEventListener('click', openModalLog);\r\n\r\nlet modalEl;\r\nfunction openModalLog() {\r\n  modalEl = document.createElement('div');\r\n  modalEl.classList.add('login');\r\n\r\n  // show modal\r\n  mui.overlay('on', modalEl);\r\n\r\n  const formMarkup = `<h1 class=\"title\">Sign In</h1>\r\n  <form class=\"modal-form\" action=\"submit\">\r\n  <label class=\"label\">\r\n  <p>Login</p>\r\n  <input type=\"text\" value=\"user@mail.com\">\r\n  </label>\r\n  <label class=\"label\">\r\n  <p>Password</p>\r\n  <input type=\"password\" value=\"12345678\">\r\n  </label>\r\n  <button class=\"button\">Join</button>\r\n  </form>\r\n  `;\r\n  modalEl.innerHTML = formMarkup;\r\n  document.querySelector('.modal-form').addEventListener('submit', onSubmitLog);\r\n}\r\n\r\nfunction onSubmitLog(e) {\r\n  e.preventDefault();\r\n  const email = e.target[0].value;\r\n  const password = e.target[1].value;\r\n  loginUser(email, password).then(getData);\r\n}\r\n\r\nfunction loginUser(email, password) {\r\n  const API_KEY = 'AIzaSyCniRY8mOu8mbV8PRMWbZHKAGJrPGGPrL8';\r\n  return fetch(\r\n    `https://identitytoolkit.googleapis.com/v1/accounts:signInWithPassword?key=${API_KEY}\r\n`,\r\n    {\r\n      method: 'POST',\r\n      body: JSON.stringify({ email, password, returnSecureToken: true }),\r\n      headers: {\r\n        'content-type': 'application/json',\r\n      },\r\n    },\r\n  )\r\n    .then(resp => resp.json())\r\n    .then(data => data.idToken);\r\n}\r\n\r\nfunction getData(token) {\r\n  if (!token) {\r\n    return Promise.reject(alert('Вы не авторизированы'));\r\n  }\r\n  return fetch(\r\n    `https://firstproject-b95dd-default-rtdb.europe-west1.firebasedatabase.app/comments.json?auth=${token}`,\r\n  )\r\n    .then(resp => resp.json())\r\n    .then(data => {\r\n      const arrData = Object.values(data);\r\n      mui.overlay('off', modalEl);\r\n      document.body.innerHTML = commentsPage(arrData);\r\n      document.querySelector('.logout').addEventListener('click', logOut);\r\n    });\r\n}\r\n\r\nfunction logOut() {\r\n  document.body.innerHTML = mainPage();\r\n  document\r\n    .querySelector('.comment-form')\r\n    .addEventListener('submit', sendRequest);\r\n  document.querySelector('.log-btn').addEventListener('click', openModalLog);\r\n  renderComments();\r\n\r\n  document.querySelector('.delete').addEventListener('click', e => {\r\n    console.log('hello');\r\n    deleteComment(e);\r\n  });\r\n}\r\n","var Handlebars = require(\"../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(container,depth0,helpers,partials,data) {\n    var helper, alias1=depth0 != null ? depth0 : (container.nullContext || {}), alias2=container.hooks.helperMissing, alias3=\"function\", alias4=container.escapeExpression, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return \"        <li>\\r\\n            <h3>\"\n    + alias4(((helper = (helper = lookupProperty(helpers,\"name\") || (depth0 != null ? lookupProperty(depth0,\"name\") : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"name\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":7,\"column\":16},\"end\":{\"line\":7,\"column\":24}}}) : helper)))\n    + \"</h3>\\r\\n            <p>\"\n    + alias4(((helper = (helper = lookupProperty(helpers,\"date\") || (depth0 != null ? lookupProperty(depth0,\"date\") : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"date\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":8,\"column\":15},\"end\":{\"line\":8,\"column\":23}}}) : helper)))\n    + \"</p>\\r\\n            <p>\"\n    + alias4(((helper = (helper = lookupProperty(helpers,\"comment\") || (depth0 != null ? lookupProperty(depth0,\"comment\") : depth0)) != null ? helper : alias2),(typeof helper === alias3 ? helper.call(alias1,{\"name\":\"comment\",\"hash\":{},\"data\":data,\"loc\":{\"start\":{\"line\":9,\"column\":15},\"end\":{\"line\":9,\"column\":26}}}) : helper)))\n    + \"</p>\\r\\n        </li>\\r\\n\";\n},\"compiler\":[8,\">= 4.3.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return \"<div>\\r\\n    <h1>Comments</h1>\\r\\n    <button class=\\\"logout\\\">LogOut</button>\\r\\n    <ol>\\r\\n\"\n    + ((stack1 = lookupProperty(helpers,\"each\").call(depth0 != null ? depth0 : (container.nullContext || {}),depth0,{\"name\":\"each\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data,\"loc\":{\"start\":{\"line\":5,\"column\":8},\"end\":{\"line\":11,\"column\":17}}})) != null ? stack1 : \"\")\n    + \"    </ol>\\r\\n</div>\";\n},\"useData\":true});","var Handlebars = require(\"../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[8,\">= 4.3.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<button class=\\\"mui-btn mui-btn--flat mui-btn--primary log-btn\\\">Login</button>\\r\\n<div class=\\\"main\\\">\\r\\n    <h1>Firebase</h1>\\r\\n    <form class=\\\"comment-form\\\" action=\\\"submit\\\">\\r\\n        <label>\\r\\n            <p>Name:</p>\\r\\n            <input type=\\\"text\\\" class=\\\"name\\\">\\r\\n        </label>\\r\\n        <label>\\r\\n            <p>Comment:</p>\\r\\n            <input class=\\\"comment\\\" type=\\\"text\\\">\\r\\n        </label>\\r\\n        <button class=\\\"submit-form\\\">SEND</button>\\r\\n    </form>\\r\\n</div>\\r\\n<ul class=\\\"comments\\\"></ul>\";\n},\"useData\":true});"],"sourceRoot":""}